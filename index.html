<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YM SelfBot â€¢ FN Party Manager</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
  
  <!-- Framer Motion (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/framer-motion@10.16.4/dist/framer-motion.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background: #0a0a0f;
      min-height: 100vh;
      color: #fff;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated background with floating orbs */
    .animated-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      overflow: hidden;
    }

    .orb {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(99, 102, 241, 0.15), rgba(168, 85, 247, 0.05));
      filter: blur(60px);
      animation: float 20s infinite ease-in-out;
    }

    .orb-1 {
      width: 500px;
      height: 500px;
      top: -200px;
      right: -100px;
      background: radial-gradient(circle at 30% 30%, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.1));
      animation-delay: 0s;
    }

    .orb-2 {
      width: 600px;
      height: 600px;
      bottom: -300px;
      left: -200px;
      background: radial-gradient(circle at 30% 30%, rgba(168, 85, 247, 0.2), rgba(99, 102, 241, 0.1));
      animation-delay: -5s;
    }

    .orb-3 {
      width: 400px;
      height: 400px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: radial-gradient(circle at 30% 30%, rgba(59, 130, 246, 0.15), rgba(99, 102, 241, 0.05));
      animation-delay: -10s;
    }

    @keyframes float {
      0%, 100% {
        transform: translate(0, 0) scale(1);
      }
      25% {
        transform: translate(50px, -50px) scale(1.1);
      }
      50% {
        transform: translate(100px, 0) scale(1);
      }
      75% {
        transform: translate(50px, 50px) scale(0.9);
      }
    }

    /* Grid overlay */
    .grid-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: 
        linear-gradient(rgba(99, 102, 241, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99, 102, 241, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      z-index: 1;
      pointer-events: none;
    }

    #root {
      position: relative;
      z-index: 2;
    }

    /* Modern glass effect */
    .glass-modern {
      background: rgba(10, 10, 15, 0.7);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(99, 102, 241, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    }

    .glass-card {
      background: rgba(18, 18, 25, 0.6);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border: 1px solid rgba(99, 102, 241, 0.2);
      transition: all 0.3s ease;
    }

    .glass-card:hover {
      border-color: rgba(99, 102, 241, 0.4);
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(99, 102, 241, 0.15);
    }

    /* Button styles */
    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      border: none;
      color: white;
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }

    .btn-primary:hover::before {
      left: 100%;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(79, 70, 229, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(99, 102, 241, 0.3);
      color: white;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-secondary:hover {
      background: rgba(99, 102, 241, 0.1);
      border-color: rgba(99, 102, 241, 0.6);
      transform: translateY(-2px);
    }

    /* Input styles */
    .input-modern {
      background: rgba(18, 18, 25, 0.8);
      border: 1px solid rgba(99, 102, 241, 0.2);
      color: white;
      transition: all 0.3s ease;
    }

    .input-modern:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
      outline: none;
    }

    .input-modern::placeholder {
      color: rgba(255,255,255,0.3);
    }

    /* Status badges */
    .status-badge {
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .status-online {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .status-offline {
      background: rgba(107, 114, 128, 0.15);
      color: #9ca3af;
      border: 1px solid rgba(107, 114, 128, 0.3);
    }

    .status-ingame {
      background: rgba(59, 130, 246, 0.15);
      color: #3b82f6;
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeInLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes fadeInRight {
      from {
        opacity: 0;
        transform: translateX(20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    @keyframes glowPulse {
      0%, 100% {
        box-shadow: 0 0 20px rgba(79, 70, 229, 0.2);
      }
      50% {
        box-shadow: 0 0 40px rgba(79, 70, 229, 0.4);
      }
    }

    .animate-fade-up {
      animation: fadeInUp 0.6s ease forwards;
    }

    .animate-fade-left {
      animation: fadeInLeft 0.6s ease forwards;
    }

    .animate-fade-right {
      animation: fadeInRight 0.6s ease forwards;
    }

    .animate-scale {
      animation: scaleIn 0.5s ease forwards;
    }

    .animate-glow {
      animation: glowPulse 3s infinite;
    }

    /* Loading spinner */
    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(79, 70, 229, 0.1);
      border-top-color: #4f46e5;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Progress bar */
    .progress-bar {
      height: 4px;
      background: rgba(79, 70, 229, 0.1);
      border-radius: 2px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4f46e5, #7c3aed);
      animation: progress 2s ease infinite;
      width: 0%;
    }

    @keyframes progress {
      0% { width: 0%; }
      50% { width: 100%; }
      100% { width: 0%; }
    }

    /* Particle effect */
    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: rgba(99, 102, 241, 0.3);
      border-radius: 50%;
      pointer-events: none;
    }

    /* Custom scrollbar */
    .custom-scrollbar::-webkit-scrollbar {
      width: 4px;
    }
    .custom-scrollbar::-webkit-scrollbar-track {
      background: transparent;
    }
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #4f46e5;
      border-radius: 4px;
    }

    /* Cooldown animation */
    @keyframes cooldown {
      from { width: 100%; }
      to { width: 0%; }
    }
    .cooldown-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      height: 2px;
      background: linear-gradient(90deg, #4f46e5, #818cf8);
      animation: cooldown 10s linear forwards;
    }
  </style>
</head>
<body>
  <div class="animated-bg">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
  </div>
  <div class="grid-overlay"></div>
  
  <div id="root">
    <div class="min-h-screen flex items-center justify-center">
      <div class="text-center">
        <div class="loading-spinner mx-auto mb-4"></div>
        <p class="text-indigo-400 text-sm font-mono animate-pulse">Loading YM SelfBot...</p>
      </div>
    </div>
  </div>

  <script type="text/babel">
    const { useState, useEffect, useCallback, useRef } = React;

    // --- CONFIG & CONSTANTS ---
    const CORS_PROXY = "https://corsproxy.io/?";
    const ACCOUNT_URL = "https://account-public-service-prod.ol.epicgames.com";
    const PARTY_URL = "https://party-service-prod.ol.epicgames.com";
    const FORTNITE_API = "https://fortnite-api.com";
    const CONTENT_URL = "https://content-service.bfda.live.use1a.on.epicgames.com";
    
    const PC_CLIENT = btoa("34a02cf8f4414e29b15921876da36f9a:daafbccc737745039dffe53d94fc76cf");
    const FN_CLIENT = btoa("ec684b8c687f479fadea3cb2ad83f5c6:e1f31c211f28413186262d37a13fc84d");
    
    const PLATFORMS = { WIN:"PC", MAC:"Mac", PSN:"PlayStation", XBL:"Xbox", SWT:"Switch", IOS:"Mobile", AND:"Android", GFN:"GFN" };
    const PLAT_EMOJI = { WIN:"ðŸ’»", MAC:"ðŸŽ", PSN:"ðŸŽ®", XBL:"ðŸŽ¯", SWT:"ðŸ•¹", IOS:"ðŸ“±", AND:"ðŸ“±", GFN:"â˜ï¸" };

    // --- COOLDOWN MANAGER ---
    class CooldownManager {
      constructor() {
        this.cooldowns = new Map();
        this.listeners = new Set();
      }

      addListener(callback) {
        this.listeners.add(callback);
        return () => this.listeners.delete(callback);
      }

      notifyListeners() {
        const cooldowns = this.getCooldowns();
        this.listeners.forEach(cb => cb(cooldowns));
      }

      setCooldown(buttonId) {
        this.cooldowns.set(buttonId, Date.now() + 10000);
        this.notifyListeners();

        setTimeout(() => {
          if (this.cooldowns.get(buttonId) <= Date.now()) {
            this.cooldowns.delete(buttonId);
            this.notifyListeners();
          }
        }, 10000);
      }

      isOnCooldown(buttonId) {
        const expiry = this.cooldowns.get(buttonId);
        if (!expiry) return false;
        if (expiry <= Date.now()) {
          this.cooldowns.delete(buttonId);
          this.notifyListeners();
          return false;
        }
        return true;
      }

      getCooldowns() {
        const result = {};
        this.cooldowns.forEach((expiry, id) => {
          if (expiry > Date.now()) {
            result[id] = Math.ceil((expiry - Date.now()) / 1000);
          }
        });
        return result;
      }
    }

    const cooldownManager = new CooldownManager();

    // --- UTILITIES ---
    const DB = {
      save: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
      load: (key) => JSON.parse(localStorage.getItem(key) || "null")
    };

    const tokenCache = new Map();
    const cosmeticCache = new Map();
    const genUUID = () => [...Array(32)].map(()=>Math.floor(Math.random()*16).toString(16)).join('').toUpperCase();
    
    const safeJson = async (res) => { try { return await res.json(); } catch { return {}; } };

    const proxyFetch = async (url, options = {}) => {
      const finalUrl = CORS_PROXY + encodeURIComponent(url);
      
      try {
        const res = await fetch(finalUrl, options);
        if (res.status === 429) {
          throw new Error("Rate limit reached. Please wait a few seconds.");
        }
        return res;
      } catch (e) {
        console.error("Proxy fetch error:", e);
        throw new Error("Network error. Please check your connection.");
      }
    };

    const epicPost = async (url, clientAuth, dataObj) => {
      const bodyParams = new URLSearchParams(dataObj).toString();
      const res = await proxyFetch(url, {
        method: "POST",
        headers: { 
          "Authorization": `Basic ${clientAuth}`, 
          "Content-Type": "application/x-www-form-urlencoded" 
        },
        body: bodyParams
      });
      const data = await safeJson(res);
      if (!res.ok) throw new Error(data.errorMessage || data.error_description || "Authentication failed");
      return data;
    };

    const refreshTokenIfNeeded = async (account) => {
      if (!account) return account;
      
      if (Date.now() > account.tokenExpiresAt - 300000) {
        try {
          const res = await epicPost(`${ACCOUNT_URL}/account/api/oauth/token`, PC_CLIENT, { 
            grant_type: "refresh_token", 
            refresh_token: account.refreshToken 
          });
          
          return {
            ...account,
            accessToken: res.access_token,
            refreshToken: res.refresh_token,
            tokenExpiresAt: Date.now() + (res.expires_in * 1000)
          };
        } catch (e) {
          console.error("Token refresh failed:", e);
          throw new Error("Session expired. Please relink.");
        }
      }
      return account;
    };

    // Parse meta helpers
    const parseMeta = (m, key) => {
      try { const v = m?.meta?.[key]; return v ? JSON.parse(v) : {}; } catch { return {}; }
    };
    
    const getDisplayName = m => m?.meta?.["urn:epic:member:dn_s"] || m?.account_id?.slice(0,8) || "?";
    
    const getPlatform = m => {
      const pd = parseMeta(m, "Default:PlatformData_j");
      return pd?.PlatformData?.platform?.platformDescription?.name
          || m?.connections?.[0]?.meta?.["urn:epic:conn:platform_s"]
          || "WIN";
    };
    
    const getLevel = m => parseMeta(m,"Default:BattlePassInfo_j")?.BattlePassInfo?.passLevel || 1;
    
    const getCrowns = m => parseMeta(m,"Default:AthenaCosmeticLoadout_j")?.AthenaCosmeticLoadout?.cosmeticStats?.find(x=>x.statName==="TotalVictoryCrowns")?.statValue || 0;
    
    const getCosmetics = (m) => {
      const loadout = parseMeta(m, "Default:AthenaCosmeticLoadout_j")?.AthenaCosmeticLoadout || {};
      const emote = parseMeta(m, "Default:FrontendEmote_j")?.FrontendEmote || {};
      
      return {
        skin: loadout.characterPrimaryAssetId || "None",
        backpack: loadout.backpackDef || "None",
        pickaxe: loadout.pickaxeDef || "None",
        emote: emote.pickable || "None",
        skinId: loadout.characterPrimaryAssetId?.replace("AthenaCharacter:", "").replace("/BRCosmetics/Athena/Items/Cosmetics/Characters/", "").replace(".", ""),
        emoteId: emote.pickable?.replace("/BRCosmetics/Athena/Items/Cosmetics/Dances/", "").replace(".", "")
      };
    };

    const getCosmeticImage = async (cosmeticId, type) => {
      if (!cosmeticId || cosmeticId === "None") return null;
      
      const cacheKey = `${type}_${cosmeticId}`;
      if (cosmeticCache.has(cacheKey)) return cosmeticCache.get(cacheKey);
      
      try {
        let apiType = "outfit";
        if (type === "emote") apiType = "emote";
        if (type === "backpack") apiType = "backpack";
        if (type === "pickaxe") apiType = "pickaxe";
        
        let cleanId = cosmeticId;
        if (cleanId.includes(":")) cleanId = cleanId.split(":")[1];
        if (cleanId.includes("/")) cleanId = cleanId.split("/").pop().split(".")[0];
        
        const response = await fetch(`${FORTNITE_API}/v2/cosmetics/br/search?id=${encodeURIComponent(cleanId)}&type=${apiType}`);
        const data = await response.json();
        
        if (data.data && data.data.images) {
          const imgUrl = data.data.images.smallIcon || data.data.images.icon;
          cosmeticCache.set(cacheKey, imgUrl);
          return imgUrl;
        }
      } catch (e) {
        console.log("Failed to fetch cosmetic:", cosmeticId);
      }
      return null;
    };

    // --- TOAST SYSTEM ---
    let _tid = 0;
    let lastToastTime = 0;
    let lastToastMsg = "";
    
    function Toasts() {
      const [list, setList] = useState([]);
      const [exiting, setExiting] = useState(new Set());
      
      useEffect(() => { 
        const fn = (t) => {
          const now = Date.now();
          if (t.msg === lastToastMsg && now - lastToastTime < 2000) return;
          
          lastToastTime = now;
          lastToastMsg = t.msg;
          
          if (t.rm) {
            setExiting(prev => new Set([...prev, t.id]));
            setTimeout(() => {
              setList(p => p.filter(x => x.id !== t.id));
              setExiting(prev => {
                const newSet = new Set(prev);
                newSet.delete(t.id);
                return newSet;
              });
            }, 200);
          } else {
            setList(p => [...p, t]);
            setTimeout(() => {
              setExiting(prev => new Set([...prev, t.id]));
              setTimeout(() => {
                setList(current => current.filter(x => x.id !== t.id));
                setExiting(prev => {
                  const newSet = new Set(prev);
                  newSet.delete(t.id);
                  return newSet;
                });
              }, 200);
            }, 2000);
          }
        };
        
        window._toast = fn; 
        return () => window._toast = null; 
      }, []);
      
      return (
        <div className="fixed bottom-4 right-4 flex flex-col gap-2 z-50">
          {list.map(t => (
            <div 
              key={t.id} 
              className={`${exiting.has(t.id) ? 'toast-exit' : 'toast-anim'} glass-modern px-4 py-3 rounded-xl border ${
                t.type === 'er' ? 'border-red-500/50' : 'border-green-500/50'
              } flex items-center gap-3`}
            >
              <i className={`fas ${t.type === 'er' ? 'fa-exclamation-circle text-red-400' : 'fa-check-circle text-green-400'}`}></i>
              <span className="text-sm">{t.msg}</span>
            </div>
          ))}
        </div>
      );
    }
    
    const toast = { 
      s: (m) => window._toast?.({id: ++_tid, msg: m, type: "ok"}), 
      e: (m) => window._toast?.({id: ++_tid, msg: m, type: "er"}) 
    };

    // --- COOLDOWN BUTTON ---
    function CooldownButton({ buttonId, onClick, children, className, disabled, title, variant = "primary" }) {
      const [cooldowns, setCooldowns] = useState({});
      const [remaining, setRemaining] = useState(0);

      useEffect(() => {
        const update = (newCooldowns) => {
          setCooldowns(newCooldowns);
          setRemaining(newCooldowns[buttonId] || 0);
        };
        
        update(cooldownManager.getCooldowns());
        return cooldownManager.addListener(update);
      }, [buttonId]);

      const isOnCooldown = cooldowns[buttonId] > 0;

      const handleClick = async (e) => {
        if (isOnCooldown || disabled) return;
        
        cooldownManager.setCooldown(buttonId);
        if (onClick) await onClick(e);
      };

      const baseClass = variant === "primary" ? "btn-primary" : "btn-secondary";

      return (
        <button
          onClick={handleClick}
          disabled={isOnCooldown || disabled}
          className={`${baseClass} ${className} relative overflow-hidden`}
          title={isOnCooldown ? `Wait ${cooldowns[buttonId]}s` : title}
        >
          {children}
          {isOnCooldown && (
            <>
              <span className="absolute inset-0 bg-black/50 flex items-center justify-center text-xs font-bold backdrop-blur-sm">
                {cooldowns[buttonId]}s
              </span>
              <div className="cooldown-bar" />
            </>
          )}
        </button>
      );
    }

    // --- SEARCH INPUT ---
    function SearchInput({ type, placeholder, onSelect }) {
      const [q, setQ] = useState("");
      const [res, setRes] = useState([]);
      const [op, setOp] = useState(false);
      const [loading, setLoading] = useState(false);
      
      useEffect(() => {
        const t = setTimeout(async () => {
          if (q.length < 2) {
            setOp(false);
            return;
          }
          
          setLoading(true);
          try {
            const r = await fetch(`${FORTNITE_API}/v2/cosmetics/br/search/all?name=${encodeURIComponent(q)}&language=en&matchMethod=contains&type=${type}`);
            const d = await r.json(); 
            if (d.data) { 
              setRes(d.data.slice(0, 5)); 
              setOp(true); 
            }
            else { setRes([]); }
          } catch {}
          setLoading(false);
        }, 400); 
        return () => clearTimeout(t);
      }, [q, type]);
      
      return (
        <div className="relative w-full">
          <div className="relative">
            <input 
              type="text" 
              placeholder={placeholder} 
              value={q} 
              onChange={e=>setQ(e.target.value)} 
              onBlur={()=>setTimeout(()=>setOp(false),200)} 
              className="w-full input-modern rounded-xl px-4 py-3 text-sm pr-10"
            />
            {loading && (
              <div className="absolute right-3 top-1/2 -translate-y-1/2">
                <i className="fas fa-spinner fa-spin text-indigo-400"></i>
              </div>
            )}
          </div>
          
          {op && res.length > 0 && (
            <div className="absolute z-50 top-full left-0 right-0 mt-2 glass-modern rounded-xl border border-indigo-500/30 overflow-hidden animate-scale">
              {res.map((s, idx) => (
                <div 
                  key={s.id} 
                  onMouseDown={()=>{onSelect(s.id); setQ(""); setOp(false);}} 
                  className="flex items-center gap-3 p-3 hover:bg-indigo-600/20 cursor-pointer border-b border-indigo-500/20 last:border-0 transition-all"
                  style={{ animationDelay: `${idx * 50}ms` }}
                >
                  {(s.images?.smallIcon || s.images?.icon) && (
                    <img src={s.images.smallIcon || s.images.icon} className="w-8 h-8 rounded-lg" alt="icon"/>
                  )}
                  <div>
                    <span className="text-sm font-bold text-white">{s.name}</span>
                    <span className="text-xs text-indigo-300 block">{s.id}</span>
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>
      );
    }

    // --- COSMETIC IMAGE ---
    function CosmeticImage({ id, type, className = "w-10 h-10" }) {
      const [imgUrl, setImgUrl] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        if (!id || id === "None") {
          setLoading(false);
          return;
        }
        
        getCosmeticImage(id, type).then(url => {
          setImgUrl(url);
          setLoading(false);
        });
      }, [id, type]);

      if (loading) {
        return <div className={`${className} glass-card rounded-xl flex items-center justify-center`}>
          <i className="fas fa-spinner fa-spin text-indigo-400"></i>
        </div>;
      }

      if (imgUrl) {
        return (
          <div className="relative group">
            <img src={imgUrl} className={`${className} rounded-xl cosmetic-image object-cover`} alt={type} />
            <div className="absolute inset-0 bg-indigo-500/0 group-hover:bg-indigo-500/20 rounded-xl transition-all duration-300"></div>
          </div>
        );
      }

      return <div className={`${className} glass-card rounded-xl flex items-center justify-center text-indigo-400`}>
        <i className={`fas ${type === 'skin' ? 'fa-user' : type === 'backpack' ? 'fa-shopping-bag' : type === 'pickaxe' ? 'fa-pickaxe' : 'fa-music'}`}></i>
      </div>;
    }

    // --- MAIN APP ---
    function App() {
      const [accounts, setAccts] = useState([]);
      const [active, setActive] = useState(null);
      const [party, setParty] = useState(null);
      const [loading, setLd] = useState(false);
      const [tab, setTab] = useState("match");
      const [authCode, setAuthCode] = useState("");
      const [busy, setBusy] = useState({});
      const [level, setLv] = useState(100);
      const [autoEmote, setAutoEmote] = useState("EID_IceKing");
      const [memberDetails, setMemberDetails] = useState({});
      const [islandCode, setIslandCode] = useState("");
      const [launchLoading, setLaunchLoading] = useState(false);
      const [launchError, setLaunchError] = useState(null);
      const [hoveredTab, setHoveredTab] = useState(null);

      // Auto refresh token
      useEffect(() => {
        if (!active) return;
        
        const interval = setInterval(async () => {
          try {
            const refreshed = await refreshTokenIfNeeded(active);
            if (refreshed !== active) {
              setActive(refreshed);
              const upd = accounts.map(a => a.accountId === refreshed.accountId ? refreshed : a);
              setAccts(upd);
              DB.save("accounts", upd);
              toast.s("Token refreshed");
            }
          } catch (e) {
            toast.e("Token expired");
            setActive(null);
            setParty(null);
          }
        }, 60000);
        
        return () => clearInterval(interval);
      }, [active, accounts]);

      useEffect(() => {
        const saved = DB.load("accounts");
        if(saved && saved.length) { setAccts(saved); selectAccount(saved[0]); }
      }, []);

      useEffect(() => {
        if (!party || !party.members) return;
        
        const loadDetails = async () => {
          const details = {};
          for (const member of party.members) {
            const cosmetics = getCosmetics(member);
            details[member.account_id] = cosmetics;
          }
          setMemberDetails(details);
        };
        
        loadDetails();
      }, [party]);

      const removeAccount = (accountId) => {
        const ups = accounts.filter(x => x.accountId !== accountId);
        setAccts(ups); DB.save("accounts", ups);
        if (active && active.accountId === accountId) { setActive(null); setParty(null); }
        toast.s("Account removed");
      };

      const getFnToken = async (acct) => {
        const refreshed = await refreshTokenIfNeeded(acct);
        if (refreshed !== acct) {
          setActive(refreshed);
          const upd = accounts.map(a => a.accountId === refreshed.accountId ? refreshed : a);
          setAccts(upd);
          DB.save("accounts", upd);
          acct = refreshed;
        }

        const cached = tokenCache.get(acct.accountId);
        if(cached && cached.exp > Date.now()) return cached.tok;

        try {
          const ex = await safeJson(await proxyFetch(`${ACCOUNT_URL}/account/api/oauth/exchange`,{headers:{Authorization:`Bearer ${acct.accessToken}`}}));
          if(!ex.code) throw new Error("Exchange failed");
          
          const fn = await epicPost(`${ACCOUNT_URL}/account/api/oauth/token`, FN_CLIENT, { grant_type:"exchange_code", exchange_code:ex.code });
          tokenCache.set(acct.accountId, {tok: fn.access_token, exp: Date.now()+(fn.expires_in-60)*1000});
          return fn.access_token;
        } catch(e) {
          removeAccount(acct.accountId);
          throw new Error("Token expired");
        }
      };

      const loadParty = async (acct) => {
        setLd(true);
        try {
          const t = await getFnToken(acct);
          const r = await safeJson(await proxyFetch(`${PARTY_URL}/party/api/v1/Fortnite/user/${acct.accountId}`, { headers: { Authorization: `Bearer ${t}` } }));
          setParty(r.current?.[0] || null);
        } catch (e) { 
          setParty(null); toast.e(e.message); 
        } finally { 
          setLd(false); 
        }
      };

      const selectAccount = async (a) => { 
        setActive(a); 
        setParty(null); 
        toast.s(`Welcome back, ${a.displayName}!`);
        await loadParty(a); 
      };
      
      const linkAccount = async () => {
        if (!authCode.trim()) return;
        setLd(true);
        try {
          const res = await epicPost(`${ACCOUNT_URL}/account/api/oauth/token`, PC_CLIENT, { grant_type: "authorization_code", code: authCode.trim() });
          
          const a = { 
            accountId: res.account_id, 
            displayName: res.displayName || res.account_id, 
            accessToken: res.access_token, 
            refreshToken: res.refresh_token, 
            tokenExpiresAt: Date.now() + (res.expires_in * 1000) 
          };
          const ups = [...accounts.filter(x => x.accountId !== a.accountId), a];
          setAccts(ups); await DB.save("accounts", ups); setAuthCode("");
          selectAccount(a); 
        } catch (e) { 
          toast.e(e.message); 
        } finally { 
          setLd(false); 
        }
      };

      const doAction = async (actionType, payload, successMsg) => {
        setBusy(p=>({...p,[actionType]:true}));
        
        try {
          if (!party || !party.id) throw new Error("No Party found!");
          
          const refreshed = await refreshTokenIfNeeded(active);
          if (refreshed !== active) {
            setActive(refreshed);
            const upd = accounts.map(a => a.accountId === refreshed.accountId ? refreshed : a);
            setAccts(upd);
            DB.save("accounts", upd);
          }
          
          const fnToken = await getFnToken(refreshed);
          
          const revData = await safeJson(await proxyFetch(`${PARTY_URL}/party/api/v1/Fortnite/user/${active.accountId}`, { headers: { Authorization: `Bearer ${fnToken}` } }));
          const pty = revData.current?.[0];
          if (!pty) throw new Error("Party not found");

          const pId = pty.id;
          const myRev = pty.members?.find(m => m.account_id === active.accountId)?.revision || 0;
          const pRev = pty.revision || 0;

          let url = `${PARTY_URL}/party/api/v1/Fortnite/parties/${pId}/members/${active.accountId}/meta`;
          let method = "PATCH";
          let body = null;

          if (actionType === "meta" || actionType === "party_meta") {
            const isParty = actionType === "party_meta";
            if (isParty) {
              url = `${PARTY_URL}/party/api/v1/Fortnite/parties/${pId}/meta`;
            }
            
            const finalUpdate = {};
            const sourceObj = isParty ? pty : pty.members.find(m => m.account_id === active.accountId);
            
            for (const [k, v] of Object.entries(payload)) {
                if (typeof v === 'function') {
                    let old = {};
                    if (sourceObj?.meta?.[k]) {
                        try { old = JSON.parse(sourceObj.meta[k]); } catch(e){}
                    }
                    finalUpdate[k] = JSON.stringify(v(old));
                } else {
                    finalUpdate[k] = v;
                }
            }
            body = { update: finalUpdate, delete: [], revision: isParty ? pRev : myRev };
          } 
          else if (actionType === "promote") {
            url = `${PARTY_URL}/party/api/v1/Fortnite/parties/${pId}/members/${payload.target}/promote`;
            method = "POST"; body = {}; 
          } 
          else if (actionType === "kick") {
            url = `${PARTY_URL}/party/api/v1/Fortnite/parties/${pId}/members/${payload.target}`;
            method = "DELETE";
          }

          const reqOpts = { method, headers: { Authorization: `Bearer ${fnToken}` } };
          if (body) {
            reqOpts.headers["Content-Type"] = "application/json";
            reqOpts.body = JSON.stringify(body);
          }

          const r = await proxyFetch(url, reqOpts);
          
          if (r.status === 404) {
            console.log("Resource not found, but continuing...");
            if (successMsg) toast.s(successMsg);
            setTimeout(() => loadParty(active), 600);
            return;
          }
          
          if (!r.ok) {
            const errData = await safeJson(r);
            throw new Error(errData.errorMessage || "Failed");
          }

          if (successMsg) toast.s(successMsg);
          setTimeout(() => loadParty(active), 600);
        } catch (e) {
          toast.e(e.message);
        } finally { 
          setBusy(p=>({...p,[actionType]:false})); 
        }
      };

      // --- COPY LOCKER ---
      const copyLocker = async (targetMemberId) => {
        const targetMember = party?.members?.find(m => m.account_id === targetMemberId);
        if (!targetMember) {
          toast.e("Member not found");
          return;
        }

        const targetCosmetics = memberDetails[targetMemberId] || getCosmetics(targetMember);
        const targetName = getDisplayName(targetMember);
        const targetLevel = getLevel(targetMember);

        try {
          await doAction("meta", {
            "Default:FrontendEmote_j": () => ({
              FrontendEmote: { pickable: "None", emoteEKey: "", emoteSection: -1, multipurposeEmoteData: -1 }
            })
          }, null);

          await new Promise(r => setTimeout(r, 300));

          await doAction("meta", {
            "Default:AthenaCosmeticLoadout_j": (old) => {
              if (!old.AthenaCosmeticLoadout) old.AthenaCosmeticLoadout = {};
              
              old.AthenaCosmeticLoadout.characterPrimaryAssetId = targetCosmetics.skin;
              old.AthenaCosmeticLoadout.backpackDef = targetCosmetics.backpack;
              old.AthenaCosmeticLoadout.pickaxeDef = targetCosmetics.pickaxe;
              
              old.AthenaCosmeticLoadout.randomDefaultCosmeticHash = Math.floor(Math.random() * 2147483647);
              return old;
            }
          }, null);

          await new Promise(r => setTimeout(r, 500));

          if (targetCosmetics.emote !== "None") {
            await doAction("meta", {
              "Default:FrontendEmote_j": () => ({
                FrontendEmote: { 
                  pickable: targetCosmetics.emote, 
                  emoteEKey: "", 
                  emoteSection: -2, 
                  multipurposeEmoteData: -1 
                }
              })
            }, null);
          }

          await doAction("meta", { 
            "Default:BattlePassInfo_j": JSON.stringify({BattlePassInfo:{bHasPurchasedPass:true, passLevel:targetLevel}}),
            "Default:AthenaBannerInfo_j": JSON.stringify({AthenaBannerInfo:{bannerIconId:"StandardBanner1", bannerColorId:"DefaultColor1", seasonLevel:targetLevel}})
          }, null);

          toast.s(`âœ¨ Copied ${targetName}'s locker + level ${targetLevel}!`);
        } catch (e) {
          toast.e(e.message);
        }
      };

      const handleSetLevel = async () => {
        await doAction("meta", { 
          "Default:BattlePassInfo_j": JSON.stringify({BattlePassInfo:{bHasPurchasedPass:true, passLevel:level}}),
          "Default:AthenaBannerInfo_j": JSON.stringify({AthenaBannerInfo:{bannerIconId:"StandardBanner1", bannerColorId:"DefaultColor1", seasonLevel:level}})
        }, `â­ Level ${level}`);
      };

      const handlePickaxeWithEmote = async () => {
        const pickaxeVal = document.getElementById("pickaxeInput")?.value.trim();
        if (!pickaxeVal) {
          toast.e("Enter pickaxe");
          return;
        }
        
        try {
          await doAction("meta", {
            "Default:FrontendEmote_j": () => ({
              FrontendEmote: { pickable: "None", emoteEKey: "", emoteSection: -1, multipurposeEmoteData: -1 }
            })
          }, null);
          
          let formattedVal = pickaxeVal;
          if (!pickaxeVal.includes("/BRCosmetics/") && !pickaxeVal.includes(":")) {
            if (pickaxeVal.startsWith("Pickaxe_")) {
              formattedVal = `/BRCosmetics/Athena/Items/Cosmetics/Pickaxes/${pickaxeVal}.${pickaxeVal}`;
            } else {
              formattedVal = `AthenaPickaxe:${pickaxeVal}`;
            }
          }
          
          await doAction("meta", {
            "Default:AthenaCosmeticLoadout_j": (old) => {
              if (!old.AthenaCosmeticLoadout) old.AthenaCosmeticLoadout = {};
              old.AthenaCosmeticLoadout.pickaxeDef = formattedVal;
              old.AthenaCosmeticLoadout.randomDefaultCosmeticHash = Math.floor(Math.random() * 2147483647);
              return old;
            }
          }, null);
          
          const emoteId = autoEmote;
          let fullEmoteId = emoteId;
          if (!emoteId.startsWith("/BRCosmetics/")) {
            if (emoteId.startsWith("EID_") || emoteId.startsWith("Emoji_") || emoteId.startsWith("Spray_")) {
              fullEmoteId = `/BRCosmetics/Athena/Items/Cosmetics/Dances/${emoteId}.${emoteId}`;
            } else {
              fullEmoteId = `/BRCosmetics/Athena/Items/Cosmetics/Dances/EID_${emoteId}.EID_${emoteId}`;
            }
          }
          
          await doAction("meta", {
            "Default:FrontendEmote_j": () => ({
              FrontendEmote: { pickable: fullEmoteId, emoteEKey: "", emoteSection: -2, multipurposeEmoteData: -1 }
            })
          }, "âœ¨ Pickaxe + Emote done!");
          
        } catch (e) {
          toast.e(e.message);
        }
      };

      const handleCosmeticUpdate = async (type) => {
        const val = document.getElementById(type + "Input")?.value.trim();
        if (!val) return;
        
        let formattedVal = val;
        
        if (!val.includes("/BRCosmetics/") && !val.includes(":")) {
          if (type === "skin") {
            formattedVal = val.startsWith("CID_") ? `AthenaCharacter:${val}` : `AthenaCharacter:CID_${val}`;
          } else if (type === "backpack") {
            formattedVal = val.startsWith("BID_") ? `/BRCosmetics/Athena/Items/Cosmetics/Backpacks/${val}.${val}` : `AthenaBackpack:${val}`;
          } else if (type === "pickaxe") {
            formattedVal = val.startsWith("Pickaxe_") ? `/BRCosmetics/Athena/Items/Cosmetics/Pickaxes/${val}.${val}` : `AthenaPickaxe:${val}`;
          }
        }
        
        await doAction("meta", {
          "Default:AthenaCosmeticLoadout_j": (old) => {
            if (!old.AthenaCosmeticLoadout) old.AthenaCosmeticLoadout = {};
            if (type === "skin") old.AthenaCosmeticLoadout.characterPrimaryAssetId = formattedVal;
            if (type === "backpack") old.AthenaCosmeticLoadout.backpackDef = formattedVal;
            if (type === "pickaxe") old.AthenaCosmeticLoadout.pickaxeDef = formattedVal;
            old.AthenaCosmeticLoadout.randomDefaultCosmeticHash = Math.floor(Math.random() * 2147483647);
            return old;
          }
        }, `${type} equipped!`);
      };

      const handleEmote = async (stop = false) => {
        const val = document.getElementById("emoteInput")?.value.trim() || "";
        
        if (stop) {
          await doAction("meta", {
            "Default:FrontendEmote_j": () => ({
              FrontendEmote: { pickable: "None", emoteEKey: "", emoteSection: -1, multipurposeEmoteData: -1 }
            })
          }, "Emote stopped");
        } else if (val) {
          let fullId = val;
          if (!val.startsWith("/BRCosmetics/")) {
            if (val.startsWith("EID_") || val.startsWith("Emoji_") || val.startsWith("Spray_")) {
              fullId = `/BRCosmetics/Athena/Items/Cosmetics/Dances/${val}.${val}`;
            } else {
              fullId = `/BRCosmetics/Athena/Items/Cosmetics/Dances/EID_${val}.EID_${val}`;
            }
          }
          
          await doAction("meta", {
            "Default:FrontendEmote_j": () => ({
              FrontendEmote: { pickable: fullId, emoteEKey: "", emoteSection: -2, multipurposeEmoteData: -1 }
            })
          }, "Playing emote!");
        }
      };

      // --- ISLAND LAUNCHER ---
      const launchIsland = async () => {
        if (!islandCode.trim() || !active) return;
        
        const safeMembers = party?.members || [];
        const isLeader = safeMembers.find(m => m.account_id === active.accountId)?.role === "CAPTAIN";
        
        if (!isLeader) {
          toast.e("Only party leader can launch islands");
          return;
        }
        
        setLaunchLoading(true);
        setLaunchError(null);
        
        try {
          const fnToken = await getFnToken(active);
          const cleanCode = islandCode.trim().replace(/[^0-9-]/g, '');
          
          if (cleanCode.length < 4) {
            throw new Error("Invalid island code format");
          }
          
          const launchRes = await proxyFetch(`${CONTENT_URL}/api/content/v2/launch/link/${cleanCode}`, {
            method: "POST",
            headers: { 
              Authorization: `Bearer ${fnToken}`,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({})
          });
          
          if (launchRes.status === 429) {
            setLaunchError("Rate limited - try again later");
            toast.e("Rate limited - try again later");
            return;
          }
          
          const response = await safeJson(launchRes);
          
          if (response.errorCode === "errors.com.epicgames.content-service.validation_error") {
            throw new Error("Invalid island code");
          }
          
          if (launchRes.ok || response.status === "notified") {
            toast.s(`ðŸš€ Launching island: ${cleanCode}`);
            setIslandCode("");
          } else {
            throw new Error(response.errorMessage || "Failed to launch");
          }
        } catch (e) {
          console.error("Launch error:", e);
          setLaunchError(e.message);
          toast.e(e.message);
        } finally {
          setLaunchLoading(false);
        }
      };

      // --- RENDER LOGIN ---
      if (!active) return (
        <div className="min-h-screen flex items-center justify-center p-4">
          <div className="glass-modern max-w-md w-full p-8 rounded-3xl border border-indigo-500/20 animate-scale">
            <div className="text-center mb-8">
              <div className="w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center animate-glow">
                <i className="fas fa-robot text-3xl text-white"></i>
              </div>
              <h1 className="text-3xl font-black bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                YM SelfBot
              </h1>
              <p className="text-sm text-indigo-300/70 mt-2">Professional Fortnite Party Manager</p>
            </div>

            {accounts.length > 0 && (
              <div className="mb-6 animate-fade-up">
                <p className="text-xs text-indigo-300 mb-3 flex items-center gap-2">
                  <i className="fas fa-history"></i> Saved Accounts
                </p>
                <div className="space-y-2">
                  {accounts.map((a, idx) => (
                    <div 
                      key={a.accountId} 
                      onClick={() => selectAccount(a)} 
                      className="glass-card p-3 rounded-xl flex items-center justify-between cursor-pointer group hover:border-indigo-500/40 transition-all"
                      style={{ animationDelay: `${idx * 100}ms` }}
                    >
                      <div className="flex items-center gap-3">
                        <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center">
                          <i className="fas fa-user text-white text-xs"></i>
                        </div>
                        <span className="font-medium text-sm">{a.displayName}</span>
                      </div>
                      <button 
                        onClick={(e) => { e.stopPropagation(); removeAccount(a.accountId); }} 
                        className="w-8 h-8 rounded-lg hover:bg-red-500/20 text-slate-400 hover:text-red-400 transition-all flex items-center justify-center"
                      >
                        <i className="fas fa-trash text-xs"></i>
                      </button>
                    </div>
                  ))}
                </div>
              </div>
            )}

            <div className="space-y-4 animate-fade-up" style={{ animationDelay: '200ms' }}>
              <a 
                href="https://www.epicgames.com/id/api/redirect?clientId=34a02cf8f4414e29b15921876da36f9a&responseType=code" 
                target="_blank" 
                className="block w-full btn-secondary text-center py-3 rounded-xl text-sm font-medium transition-all hover:scale-[1.02]"
              >
                <i className="fas fa-key mr-2"></i>
                Get Epic Auth Code
              </a>
              
              <div className="flex gap-2">
                <input 
                  type="text" 
                  placeholder="Paste your auth code" 
                  value={authCode} 
                  onChange={e => setAuthCode(e.target.value)} 
                  onKeyDown={e=>e.key==="Enter"&&linkAccount()} 
                  className="flex-1 input-modern rounded-xl px-4 py-3 text-sm"
                />
                <button 
                  onClick={linkAccount} 
                  disabled={loading||!authCode.trim()} 
                  className="btn-primary px-6 rounded-xl text-sm font-medium disabled:opacity-50 min-w-[80px]"
                >
                  {loading ? <i className="fas fa-spinner fa-spin"></i> : "Link"}
                </button>
              </div>

              <p className="text-xs text-center text-slate-500 mt-4">
                <i className="fas fa-shield-alt mr-1 text-indigo-400"></i>
                Your tokens are stored locally
              </p>
            </div>
          </div>
        </div>
      );

      const safeParty = party || {};
      const safeMembers = safeParty.members || [];
      const isCap = safeMembers.find(m => m.account_id === active.accountId)?.role === "CAPTAIN";

      return (
        <div className="min-h-screen p-4 max-w-7xl mx-auto">
          {/* Header */}
          <div className="glass-modern rounded-2xl p-4 mb-6 flex items-center justify-between animate-fade-up">
            <div className="flex items-center gap-4">
              <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-600 to-purple-600 flex items-center justify-center relative">
                <i className="fas fa-robot text-white text-lg"></i>
                <div className="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-slate-900 animate-pulse"></div>
              </div>
              <div>
                <h1 className="text-lg font-bold">
                  <span className="bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                    YM SelfBot
                  </span>
                </h1>
                <p className="text-xs text-slate-400 flex items-center gap-2">
                  <i className="fas fa-circle text-green-500 text-[6px]"></i>
                  {active.displayName}
                </p>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <button 
                onClick={() => loadParty(active)} 
                disabled={loading} 
                className="btn-secondary px-4 py-2 rounded-xl text-xs font-medium flex items-center gap-2"
              >
                <i className={`fas fa-sync-alt text-xs ${loading ? 'fa-spin' : ''}`}></i>
                {loading ? "Loading..." : "Refresh"}
              </button>
              <button 
                onClick={() => { setActive(null); setParty(null); }} 
                className="btn-secondary px-4 py-2 rounded-xl text-xs font-medium text-red-400 hover:bg-red-500/20"
              >
                <i className="fas fa-sign-out-alt mr-1"></i>
                Exit
              </button>
            </div>
          </div>

          {!party ? (
            <div className="glass-modern rounded-3xl p-12 text-center border border-dashed border-indigo-500/30 animate-scale">
              <div className="text-6xl mb-4 opacity-50 animate-bounce">ðŸŽ®</div>
              <h2 className="text-2xl font-bold mb-2 bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">
                No Active Party
              </h2>
              <p className="text-sm text-slate-400 max-w-md mx-auto mb-6">
                Launch Fortnite and join a lobby to start managing your party
              </p>
              <div className="progress-bar max-w-xs mx-auto mb-6">
                <div className="progress-fill"></div>
              </div>
              <button 
                onClick={() => loadParty(active)} 
                className="btn-primary px-8 py-3 rounded-xl text-sm font-medium"
              >
                <i className="fas fa-sync-alt mr-2"></i>
                Check Again
              </button>
            </div>
          ) : (
            <div className="grid grid-cols-1 lg:grid-cols-5 gap-6">
              {/* Sidebar */}
              <div className="lg:col-span-1">
                <div className="glass-modern rounded-2xl p-3 border border-indigo-500/20 animate-fade-left">
                  <div className="space-y-1">
                    {[
                      { id: "match", icon: "fa-gamepad", label: "Match Control", color: "from-blue-600 to-cyan-600" },
                      { id: "locker", icon: "fa-tshirt", label: "Locker Spoofer", color: "from-purple-600 to-pink-600" },
                      { id: "extra", icon: "fa-star", label: "Season Level", color: "from-yellow-600 to-orange-600" },
                      { id: "members", icon: "fa-users", label: `Party Members (${safeMembers.length})`, color: "from-green-600 to-emerald-600" },
                      { id: "islands", icon: "fa-map", label: "Island Launcher", color: "from-teal-600 to-cyan-600" }
                    ].map((t, idx) => (
                      <button 
                        key={t.id} 
                        onClick={() => setTab(t.id)}
                        onMouseEnter={() => setHoveredTab(t.id)}
                        onMouseLeave={() => setHoveredTab(null)}
                        className={`w-full p-3 rounded-xl transition-all duration-300 text-left flex items-center gap-3 text-sm ${
                          tab === t.id 
                            ? `bg-gradient-to-r ${t.color} text-white shadow-lg scale-[1.02]` 
                            : 'hover:bg-white/5 text-slate-400 hover:text-white'
                        }`}
                        style={{ animationDelay: `${idx * 50}ms` }}
                      >
                        <i className={`fas ${t.icon} text-sm ${tab === t.id ? 'text-white' : 'text-indigo-400'}`}></i>
                        <span className="font-medium flex-1">{t.label}</span>
                        {hoveredTab === t.id && (
                          <i className="fas fa-chevron-right text-xs animate-pulse"></i>
                        )}
                      </button>
                    ))}
                  </div>
                  
                  {isCap && (
                    <div className="mt-4 pt-4 border-t border-indigo-500/20 animate-fade-up">
                      <p className="text-xs text-indigo-300 flex items-center gap-2">
                        <i className="fas fa-crown text-yellow-500 text-xs animate-pulse"></i>
                        Party Leader
                      </p>
                    </div>
                  )}
                </div>
              </div>

              {/* Main Content */}
              <div className="lg:col-span-4 space-y-6">
                {tab === "match" && (
                  <div className="space-y-6 animate-fade-right">
                    <div className="glass-modern rounded-2xl p-6 border-l-4 border-indigo-500">
                      <h3 className="text-base font-bold mb-4 flex items-center gap-2">
                        <i className="fas fa-check-circle text-indigo-400"></i>
                        Readiness Status
                      </h3>
                      <div className="grid grid-cols-2 lg:grid-cols-4 gap-3">
                        <CooldownButton
                          buttonId="ready"
                          onClick={() => doAction("meta", {
                            "Default:GameReadiness_s": "Ready", 
                            "Default:Location_s": "PreLobby",
                            "Default:PackedState_j": (old) => { if(old.PackedState) old.PackedState.location = "PreLobby"; return old; },
                            "Default:MatchmakingInfo_j": (old) => { if(old.MatchmakingInfo) old.MatchmakingInfo.readyStatus = "Ready"; return old; }
                          }, "Ready!")}
                          className="p-3 bg-green-600/20 hover:bg-green-600/30 border border-green-500/30 rounded-xl text-green-400 text-sm font-medium flex items-center justify-center gap-2 w-full"
                        >
                          <i className="fas fa-check"></i> Ready
                        </CooldownButton>

                        <CooldownButton
                          buttonId="notready"
                          onClick={() => doAction("meta", {
                            "Default:GameReadiness_s": "NotReady", 
                            "Default:Location_s": "PreLobby",
                            "Default:PackedState_j": (old) => { if(old.PackedState) old.PackedState.location = "PreLobby"; return old; },
                            "Default:MatchmakingInfo_j": (old) => { if(old.MatchmakingInfo) old.MatchmakingInfo.readyStatus = "NotReady"; return old; }
                          }, "Not Ready")}
                          className="p-3 bg-slate-700/50 hover:bg-slate-600/50 border border-slate-600 rounded-xl text-sm font-medium flex items-center justify-center gap-2 w-full"
                        >
                          <i className="fas fa-times"></i> Not Ready
                        </CooldownButton>

                        <CooldownButton
                          buttonId="sitout"
                          onClick={() => doAction("meta", {
                            "Default:GameReadiness_s": "SittingOut", 
                            "Default:Location_s": "PreLobby",
                            "Default:PackedState_j": (old) => { if(old.PackedState) old.PackedState.location = "PreLobby"; return old; },
                            "Default:MatchmakingInfo_j": (old) => { if(old.MatchmakingInfo) old.MatchmakingInfo.readyStatus = "SittingOut"; return old; }
                          }, "Sit Out")}
                          className="p-3 bg-yellow-600/20 hover:bg-yellow-600/30 border border-yellow-500/30 rounded-xl text-yellow-400 text-sm font-medium flex items-center justify-center gap-2 w-full"
                        >
                          <i className="fas fa-bed"></i> Sit Out
                        </CooldownButton>

                        <CooldownButton
                          buttonId="standin"
                          onClick={() => doAction("meta", {
                            "Default:GameReadiness_s": "NotReady", 
                            "Default:Location_s": "PreLobby",
                            "Default:PackedState_j": (old) => { if(old.PackedState) old.PackedState.location = "PreLobby"; return old; },
                            "Default:MatchmakingInfo_j": (old) => { if(old.MatchmakingInfo) old.MatchmakingInfo.readyStatus = "NotReady"; return old; }
                          }, "Stand In")}
                          className="p-3 bg-blue-600/20 hover:bg-blue-600/30 border border-blue-500/30 rounded-xl text-blue-400 text-sm font-medium flex items-center justify-center gap-2 w-full"
                        >
                          <i className="fas fa-person-walking"></i> Stand In
                        </CooldownButton>
                      </div>
                    </div>

                    <div className="glass-modern rounded-2xl p-6 border-l-4 border-purple-500">
                      <h3 className="text-base font-bold mb-4 flex items-center gap-2">
                        <i className="fas fa-mask text-purple-400"></i>
                        Fake Match
                      </h3>
                      <div className="flex gap-3">
                        <CooldownButton
                          buttonId="fakematch"
                          onClick={() => {
                            const s = genUUID();
                            doAction("meta", { 
                              "Default:GameReadiness_s": "Playing", 
                              "Default:Location_s": "InGame", 
                              "Default:PackedState_j": (old) => { if(old.PackedState) old.PackedState.location = "InGame"; return old; },
                              "Default:MatchmakingInfo_j": (old) => {
                                if(!old.MatchmakingInfo) old.MatchmakingInfo = {};
                                old.MatchmakingInfo.readyStatus = "NotReady";
                                old.MatchmakingInfo.bIsEligible = true;
                                old.MatchmakingInfo.currentIsland = {island:`{"LinkId":"","Session":{"iD":"${s}","joinInfo":{"joinability":"CanNotBeJoinedOrWatched","sessionKey":"${s}"}},"MatchmakingSettingsV2":{"/Fortnite.com/Matchmaking:Region":"EU"}}`, timestamp:Date.now(), bUsingGracefulUpgrade:true, matchmakingId:s};
                                old.MatchmakingInfo.worldSessionId = s;
                                old.MatchmakingInfo.travelId = s;
                                return old;
                              }
                            }, "In Match!")
                          }}
                          className="flex-1 btn-primary py-3 rounded-xl text-sm font-medium flex items-center justify-center gap-2"
                        >
                          <i className="fas fa-play"></i> Enter Match
                        </CooldownButton>

                        <CooldownButton
                          buttonId="leavematch"
                          onClick={() => doAction("meta", {
                            "Default:GameReadiness_s": "NotReady", 
                            "Default:Location_s": "PreLobby", 
                            "Default:PackedState_j": (old) => { if(old.PackedState) old.PackedState.location = "PreLobby"; return old; },
                            "Default:MatchmakingInfo_j": (old) => { if(old.MatchmakingInfo) old.MatchmakingInfo.readyStatus = "NotReady"; return old; }
                          }, "Left Match")}
                          className="flex-1 btn-secondary py-3 rounded-xl text-sm font-medium flex items-center justify-center gap-2"
                        >
                          <i className="fas fa-door-open"></i> Leave Match
                        </CooldownButton>
                      </div>
                    </div>
                  </div>
                )}

                {tab === "locker" && (
                  <div className="glass-modern rounded-2xl p-6 border-l-4 border-purple-500 animate-fade-right">
                    <h3 className="text-base font-bold mb-6 flex items-center gap-2">
                      <i className="fas fa-tshirt text-purple-400"></i>
                      Locker Spoofer
                    </h3>
                    
                    <div className="bg-indigo-950/30 border border-indigo-500/20 p-4 rounded-xl mb-6">
                      <p className="text-xs text-indigo-300 flex items-center gap-2">
                        <i className="fas fa-info-circle"></i>
                        Must be in <span className="text-yellow-400 font-medium">Stand In</span> or <span className="text-green-400 font-medium">Not Ready</span>
                      </p>
                    </div>

                    <div className="space-y-4">
                      <div className="glass-card p-4 rounded-xl">
                        <label className="block text-xs font-medium text-indigo-300 mb-2 flex items-center gap-1">
                          <i className="fas fa-music"></i>
                          Auto Emote
                        </label>
                        <input 
                          type="text" 
                          value={autoEmote} 
                          onChange={e => setAutoEmote(e.target.value)} 
                          placeholder="EID_IceKing" 
                          className="w-full input-modern rounded-xl px-4 py-3 text-sm" 
                        />
                      </div>

                      <div className="glass-card p-4 rounded-xl">
                        <label className="block text-xs font-medium text-indigo-300 mb-2">Emote</label>
                        <div className="flex flex-col gap-3">
                          <SearchInput type="emote" placeholder="Search emote..." onSelect={(id) => document.getElementById('emoteInput').value = id} />
                          <div className="flex gap-2">
                            <input type="text" placeholder="EID_IceKing" id="emoteInput" className="flex-1 input-modern rounded-xl px-4 py-3 text-sm" />
                            <CooldownButton
                              buttonId="playemote"
                              onClick={() => handleEmote(false)}
                              className="btn-primary px-4 rounded-xl text-sm"
                            >
                              <i className="fas fa-play"></i>
                            </CooldownButton>
                            <CooldownButton
                              buttonId="stopemote"
                              onClick={() => handleEmote(true)}
                              className="btn-secondary px-4 rounded-xl text-sm text-red-400"
                            >
                              <i className="fas fa-stop"></i>
                            </CooldownButton>
                          </div>
                        </div>
                      </div>

                      <div className="glass-card p-4 rounded-xl">
                        <label className="block text-xs font-medium text-indigo-300 mb-2">Skin</label>
                        <div className="flex flex-col gap-3">
                          <SearchInput type="outfit" placeholder="Search skin..." onSelect={(id) => document.getElementById('skinInput').value = id} />
                          <div className="flex gap-2">
                            <input type="text" placeholder="CID_028_Athena_Commando_F" id="skinInput" className="flex-1 input-modern rounded-xl px-4 py-3 text-sm" />
                            <CooldownButton
                              buttonId="setskin"
                              onClick={() => handleCosmeticUpdate('skin')}
                              className="btn-primary px-6 rounded-xl text-sm"
                            >
                              Set
                            </CooldownButton>
                          </div>
                        </div>
                      </div>

                      <div className="grid grid-cols-2 gap-4">
                        <div className="glass-card p-4 rounded-xl">
                          <label className="flex items-center gap-1 text-xs font-medium text-indigo-300 mb-2">
                            <i className="fas fa-shopping-bag"></i> Backbling
                          </label>
                          <SearchInput type="backpack" placeholder="BID_138..." onSelect={(id) => document.getElementById('backpackInput').value = id} />
                          <div className="flex gap-2 mt-3">
                            <input type="text" placeholder="BID_138_Cuatro" id="backpackInput" className="flex-1 input-modern rounded-xl px-3 py-2 text-sm" />
                            <CooldownButton
                              buttonId="setbackpack"
                              onClick={() => handleCosmeticUpdate('backpack')}
                              className="btn-secondary px-3 rounded-xl text-sm"
                            >
                              Set
                            </CooldownButton>
                          </div>
                        </div>

                        <div className="glass-card p-4 rounded-xl">
                          <label className="flex items-center gap-1 text-xs font-medium text-indigo-300 mb-2">
                            <i className="fas fa-pickaxe"></i> Pickaxe
                          </label>
                          <SearchInput type="pickaxe" placeholder="Pickaxe_ID..." onSelect={(id) => document.getElementById('pickaxeInput').value = id} />
                          <div className="flex gap-2 mt-3">
                            <input type="text" placeholder="Pickaxe_ID_015" id="pickaxeInput" className="flex-1 input-modern rounded-xl px-3 py-2 text-sm" />
                            <CooldownButton
                              buttonId="pickaxeemote"
                              onClick={handlePickaxeWithEmote}
                              className="btn-primary px-3 rounded-xl text-sm"
                            >
                              <i className="fas fa-magic mr-1"></i>+Emote
                            </CooldownButton>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                )}

                {tab === "extra" && (
                  <div className="glass-modern rounded-2xl p-6 border-l-4 border-yellow-500 animate-fade-right">
                    <h3 className="text-base font-bold mb-4 flex items-center gap-2">
                      <i className="fas fa-star text-yellow-400"></i>
                      Season Level
                    </h3>
                    <div className="flex gap-3 max-w-md">
                      <input 
                        type="number" 
                        min="1" 
                        max="1000" 
                        value={level} 
                        onChange={e=>setLv(Number(e.target.value))} 
                        className="flex-1 input-modern rounded-xl px-4 py-3 text-sm text-center" 
                      />
                      <CooldownButton
                        buttonId="setlevel"
                        onClick={handleSetLevel}
                        className="btn-primary px-8 rounded-xl text-sm"
                      >
                        Set
                      </CooldownButton>
                    </div>
                  </div>
                )}

                {tab === "members" && (
                  <div className="glass-modern rounded-2xl p-6 border-l-4 border-green-500 animate-fade-right">
                    <h3 className="text-base font-bold mb-4 flex items-center gap-2">
                      <i className="fas fa-users text-green-400"></i>
                      Party Members ({safeMembers.length})
                    </h3>
                    
                    <div className="space-y-3 max-h-[600px] overflow-y-auto custom-scrollbar pr-2">
                      {safeMembers.length === 0 && (
                        <div className="text-center text-slate-500 py-12">
                          <i className="fas fa-users-slash text-4xl mb-3 opacity-30"></i>
                          <p className="text-sm">No members in party</p>
                        </div>
                      )}
                      
                      {safeMembers.map((m, idx) => {
                        const nm = getDisplayName(m);
                        const cr = getCrowns(m);
                        const pl = getPlatform(m);
                        const lv = getLevel(m);
                        const cosmetics = memberDetails[m.account_id] || getCosmetics(m);
                        
                        const rd = m.meta?.["Default:GameReadiness_s"] || "";
                        const ls = m.meta?.["Default:Location_s"] || "";
                        
                        const inM = rd === "Playing" || ls === "InGame";
                        const sit = rd === "SittingOut";
                        const rdy = rd === "Ready";
                        
                        const isMe = m.account_id === active.accountId;
                        
                        return (
                          <div 
                            key={m.account_id} 
                            className={`glass-card p-4 rounded-xl border transition-all duration-300 hover:scale-[1.01] ${
                              isMe ? 'border-indigo-500' : 'border-indigo-500/10'
                            }`}
                            style={{ animationDelay: `${idx * 50}ms` }}
                          >
                            <div className="flex items-center justify-between mb-3">
                              <div className="flex items-center gap-3">
                                <div className="relative">
                                  <div className={`w-10 h-10 rounded-xl flex items-center justify-center text-lg ${isMe ? 'bg-indigo-600' : 'glass-card'}`}>
                                    {PLAT_EMOJI[pl] || "ðŸ’»"}
                                  </div>
                                  {m.role === "CAPTAIN" && (
                                    <div className="absolute -top-2 -right-2 bg-yellow-500 rounded-full p-1">
                                      <i className="fas fa-crown text-[8px] text-yellow-900"></i>
                                    </div>
                                  )}
                                </div>
                                <div>
                                  <div className="flex items-center gap-2">
                                    <span className="text-sm font-medium">{nm}</span>
                                    {cr > 0 && (
                                      <span className="text-[10px] bg-yellow-600/30 text-yellow-500 px-2 py-0.5 rounded-full border border-yellow-500/30 flex items-center gap-1">
                                        <i className="fas fa-crown text-[8px]"></i> {cr}
                                      </span>
                                    )}
                                  </div>
                                  <p className="text-xs text-slate-400">
                                    {PLATFORMS[pl] || pl} â€¢ Level {lv}
                                    {isMe && <span className="ml-2 text-indigo-400">(You)</span>}
                                  </p>
                                </div>
                              </div>

                              <div className="flex items-center gap-2">
                                <span className={`status-badge ${
                                  inM ? 'status-ingame' : sit ? 'status-offline' : rdy ? 'status-online' : 'status-offline'
                                }`}>
                                  {inM ? 'IN MATCH' : sit ? 'SIT OUT' : rdy ? 'READY' : 'NOT READY'}
                                </span>
                                
                                {!isMe && (
                                  <CooldownButton
                                    buttonId={`copy_${m.account_id}`}
                                    onClick={() => copyLocker(m.account_id)}
                                    className="w-8 h-8 rounded-lg hover:bg-indigo-600/30 text-slate-400 hover:text-indigo-400 transition-all"
                                    variant="secondary"
                                  >
                                    <i className="fas fa-copy text-xs"></i>
                                  </CooldownButton>
                                )}
                                
                                {isCap && !isMe && (
                                  <>
                                    <CooldownButton
                                      buttonId={`promote_${m.account_id}`}
                                      onClick={() => doAction("promote", {target: m.account_id}, `${nm} is now leader!`)}
                                      className="w-8 h-8 rounded-lg hover:bg-yellow-600/30 text-slate-400 hover:text-yellow-400 transition-all"
                                      variant="secondary"
                                    >
                                      <i className="fas fa-crown text-xs"></i>
                                    </CooldownButton>
                                    <CooldownButton
                                      buttonId={`kick_${m.account_id}`}
                                      onClick={() => doAction("kick", {target: m.account_id}, `${nm} kicked!`)}
                                      className="w-8 h-8 rounded-lg hover:bg-red-600/30 text-slate-400 hover:text-red-400 transition-all"
                                      variant="secondary"
                                    >
                                      <i className="fas fa-times text-xs"></i>
                                    </CooldownButton>
                                  </>
                                )}
                              </div>
                            </div>

                            <div className="pt-3 border-t border-indigo-500/20">
                              <div className="grid grid-cols-4 gap-3">
                                <div className="flex flex-col items-center">
                                  <CosmeticImage id={cosmetics.skin} type="skin" />
                                  <span className="text-[10px] text-indigo-300 mt-1 truncate w-full text-center">
                                    {cosmetics.skinId || 'None'}
                                  </span>
                                </div>
                                
                                <div className="flex flex-col items-center">
                                  <CosmeticImage id={cosmetics.backpack} type="backpack" />
                                  <span className="text-[10px] text-indigo-300 mt-1 truncate w-full text-center">
                                    {cosmetics.backpack?.split(':')[1]?.split('/').pop()?.split('.')[0] || 'None'}
                                  </span>
                                </div>
                                
                                <div className="flex flex-col items-center">
                                  <CosmeticImage id={cosmetics.pickaxe} type="pickaxe" />
                                  <span className="text-[10px] text-indigo-300 mt-1 truncate w-full text-center">
                                    {cosmetics.pickaxe?.split(':')[1]?.split('/').pop()?.split('.')[0] || 'None'}
                                  </span>
                                </div>
                                
                                <div className="flex flex-col items-center">
                                  <CosmeticImage id={cosmetics.emote} type="emote" />
                                  <span className="text-[10px] text-indigo-300 mt-1 truncate w-full text-center">
                                    {cosmetics.emoteId || 'None'}
                                  </span>
                                </div>
                              </div>
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                )}

                {tab === "islands" && (
                  <div className="glass-modern rounded-2xl p-6 border-l-4 border-teal-500 animate-fade-right">
                    <h3 className="text-base font-bold mb-4 flex items-center gap-2">
                      <i className="fas fa-map text-teal-400"></i>
                      Island Launcher
                    </h3>
                    
                    <div className="bg-indigo-950/30 border border-indigo-500/20 p-4 rounded-xl mb-4">
                      <p className="text-xs text-indigo-300">
                        <i className="fas fa-info-circle mr-1"></i>
                        {isCap 
                          ? "Enter any Fortnite island code (format: 1234-5678-9012)" 
                          : "âš ï¸ Only party leader can launch islands"}
                      </p>
                    </div>

                    {launchError && (
                      <div className="bg-red-950/30 border border-red-500/30 p-3 rounded-xl mb-4">
                        <p className="text-xs text-red-400 flex items-center gap-2">
                          <i className="fas fa-exclamation-triangle"></i>
                          {launchError}
                        </p>
                      </div>
                    )}

                    <div className="flex gap-3">
                      <input
                        type="text"
                        value={islandCode}
                        onChange={(e) => setIslandCode(e.target.value)}
                        placeholder="e.g., 1234-5678-9012"
                        className="flex-1 input-modern rounded-xl px-4 py-3 text-sm font-mono"
                        disabled={!isCap}
                      />
                      <CooldownButton
                        buttonId="launchisland"
                        onClick={launchIsland}
                        disabled={!islandCode.trim() || launchLoading || !isCap}
                        className="btn-primary px-8 rounded-xl text-sm font-medium"
                      >
                        {launchLoading ? <i className="fas fa-spinner fa-spin"></i> : 'Launch'}
                      </CooldownButton>
                    </div>
                  </div>
                )}
              </div>
            </div>
          )}
          <Toasts />
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
